import json
import urllib2

import ggeocoder
from zope.component import getUtility

from mr.cabot.interfaces import IUserDatabase
from mr.cabot.git import GitRepo
from mr.cabot.users import User

REPOS = {'Plone':"git://github.com/plone/Plone",
'archetypes_kss':"git://github.com/plone/archetypes.kss",
'archetypes_querywidget':"git://github.com/plone/archetypes.querywidget",
'archetypes_referencebrowserwidget':"git://github.com/plone/archetypes.referencebrowserwidget",
'archetypes_schemaextender':"git://github.com/plone/archetypes.schemaextender",
'borg_localrole':"git://github.com/plone/borg.localrole",
'collective_monkeypatcher':"git://github.com/plone/collective.monkeypatcher",
'collective_testcaselayer':"git://github.com/collective/collective.testcaselayer",
'collective_z3cform_datetimewidget':"git://github.com/collective/collective.z3cform.datetimewidget",
'diazo':"git://github.com/plone/diazo",
'plone_autoform':"git://github.com/plone/plone.autoform",
'plone_browserlayer':"git://github.com/plone/plone.browserlayer",
'plone_caching':"git://github.com/plone/plone.caching",
'plone_cachepurging':"git://github.com/plone/plone.cachepurging",
'plone_contentrules':"git://github.com/plone/plone.contentrules",
'plone_fieldsets':"git://github.com/plone/plone.fieldsets",
'plone_folder':"git://github.com/plone/plone.folder",
'plone_i18n':"git://github.com/plone/plone.i18n",
'plone_indexer':"git://github.com/plone/plone.indexer",
'plone_intelligenttext':"git://github.com/plone/plone.intelligenttext",
'plone_keyring':"git://github.com/plone/plone.keyring",
'plone_locking':"git://github.com/plone/plone.locking",
'plone_memoize':"git://github.com/plone/plone.memoize",
'plone_openid':"git://github.com/plone/plone.openid",
'plone_outputfilters':"git://github.com/plone/plone.outputfilters",
'plone_portlets':"git://github.com/plone/plone.portlets",
'plone_protect':"git://github.com/plone/plone.protect",
'plone_registry':"git://github.com/plone/plone.registry",
'plone_reload':"https://github.com/hannosch/plone.reload",
'plone_resource':"git://github.com/plone/plone.resource",
'plone_scale':"git://github.com/plone/plone.scale",
'plone_session':"git://github.com/plone/plone.session",
'plone_stringinterp':"git://github.com/plone/plone.stringinterp",
'plone_subrequest':"git://github.com/plone/plone.subrequest",
'plone_supermodel':"git://github.com/plone/plone.supermodel",
'plone_testing':"git://github.com/plone/plone.testing",
'plone_theme':"git://github.com/plone/plone.theme",
'plone_transformchain':"git://github.com/plone/plone.transformchain",
'plone_uuid':"git://github.com/plone/plone.uuid",
'plone_app_blob':"git://github.com/plone/plone.app.blob",
'plone_app_caching':"git://github.com/plone/plone.app.caching",
'plone_app_collection':"git://github.com/plone/plone.app.collection",
'plone_app_content':"git://github.com/plone/plone.app.content",
'plone_app_contentlisting':"git://github.com/plone/plone.app.contentlisting",
'plone_app_contentmenu':"git://github.com/plone/plone.app.contentmenu",
'plone_app_contentrules':"git://github.com/plone/plone.app.contentrules",
'plone_app_controlpanel':"git://github.com/plone/plone.app.controlpanel",
'plone_app_customerize':"git://github.com/plone/plone.app.customerize",
'plone_app_discussion':"git://github.com/plone/plone.app.discussion",
'plone_app_folder':"git://github.com/plone/plone.app.folder",
'plone_app_form':"git://github.com/plone/plone.app.form",
'plone_app_i18n':"git://github.com/plone/plone.app.i18n",
'plone_app_imaging':"git://github.com/plone/plone.app.imaging",
'plone_app_iterate':"git://github.com/plone/plone.app.iterate",
'plone_app_jquery':"git://github.com/plone/plone.app.jquery",
'plone_app_jquerytools':"git://github.com/plone/plone.app.jquerytools",
'plone_app_kss':"git://github.com/plone/plone.app.kss",
'plone_app_layout':"git://github.com/plone/plone.app.layout",
'plone_app_linkintegrity':"git://github.com/plone/plone.app.linkintegrity",
'plone_app_locales':"git://github.com/collective/plone.app.locales",
'plone_app_openid':"git://github.com/plone/plone.app.openid",
'plone_app_portlets':"git://github.com/plone/plone.app.portlets",
'plone_app_querystring':"git://github.com/plone/plone.app.querystring",
'plone_app_redirector':"git://github.com/plone/plone.app.redirector",
'plone_app_registry':"git://github.com/plone/plone.app.registry",
'plone_app_search':"git://github.com/plone/plone.app.search",
'plone_app_testing':"git://github.com/plone/plone.app.testing",
'plone_app_theming':"git://github.com/plone/plone.app.theming",
'plone_app_upgrade':"git://github.com/plone/plone.app.upgrade",
'plone_app_users':"git://github.com/plone/plone.app.users",
'plone_app_uuid':"git://github.com/plone/plone.app.uuid",
'plone_app_viewletmanager':"git://github.com/plone/plone.app.viewletmanager",
'plone_app_vocabularies':"git://github.com/plone/plone.app.vocabularies",
'plone_app_workflow':"git://github.com/plone/plone.app.workflow",
'plone_app_z3cform':"git://github.com/plone/plone.app.z3cform",
'plone_portlet_collection':"git://github.com/plone/plone.portlet.collection",
'plone_portlet_static':"git://github.com/plone/plone.portlet.static",
'plone_recipe_alltests':"git://github.com/plone/plone.recipe.alltests",
'plone_recipe_zope2instance':"git://github.com/plone/plone.recipe.zope2instance",
'plone_recipe_zeoserver':"git://github.com/plone/plone.recipe.zeoserver",
'plonetheme_sunburst':"git://github.com/plone/plonetheme.sunburst",
'plonetheme_classic':"git://github.com/plone/plonetheme.classic",
'repoze_xmliter':"https://github.com/repoze/repoze.xmliter",
'txtfilter':"git://github.com/plone/txtfilter",
'wicked':"git://github.com/plone/wicked",
'Products_Archetypes':"git://github.com/plone/Products.Archetypes",
'Products_ATContentTypes':"git://github.com/plone/Products.ATContentTypes",
'Products_ATReferenceBrowserWidget':"git://github.com/plone/Products.ATReferenceBrowserWidget",
'Products_CMFDiffTool':"git://github.com/plone/Products.CMFDiffTool",
'Products_CMFDynamicViewFTI':"git://github.com/plone/Products.CMFDynamicViewFTI",
'Products_CMFEditions':"git://github.com/plone/Products.CMFEditions",
'Products_CMFFormController':"git://github.com/plone/Products.CMFFormController",
'Products_CMFPlacefulWorkflow':"git://github.com/plone/Products.CMFPlacefulWorkflow",
'Products_CMFPlone':"git://github.com/plone/Products.CMFPlone",
'Products_CMFQuickInstallerTool':"git://github.com/plone/Products.CMFQuickInstallerTool",
'Products_CMFTestCase':"git://github.com/plone/Products.CMFTestCase",
'Products_contentmigration':"git://github.com/plone/Products.contentmigration",
'Products_ExtendedPathIndex':"git://github.com/plone/Products.ExtendedPathIndex",
'Products_i18ntestcase':"git://github.com/plone/Products.i18ntestcase",
'Products_LinguaPlone':"git://github.com/plone/Products.LinguaPlone",
'Products_Marshall':"git://github.com/plone/Products.Marshall",
'Products_MimetypesRegistry':"git://github.com/plone/Products.MimetypesRegistry",
'Products_PasswordResetTool':"git://github.com/plone/Products.PasswordResetTool",
'Products_PlacelessTranslationService':"t://github.com/plone/Products.PlacelessTranslationService",
'Products_PloneLanguageTool':"git://github.com/plone/Products.PloneLanguageTool",
'Products_PlonePAS':"git://github.com/plone/Products.PlonePAS",
'Products_PloneTestCase':"git://github.com/plone/Products.PloneTestCase",
'Products_PortalTransforms':"git://github.com/plone/Products.PortalTransforms",
'Products_ResourceRegistries':"git://github.com/plone/Products.ResourceRegistries",
'Products_statusmessages':"git://github.com/plone/Products.statusmessages",
'Products_TinyMCE':"git://github.com/plone/Products.TinyMCE",
'Products_validation':"git://github.com/plone/Products.validation"}

GITHUB_ACCOUNTS = {
    'ableeb',
    'ablumer',
    'aclark4life',
    'acsr',
    'adam139',
    'afrepues',
    'agitator',
    'agnogueira',
    'albertoserrano',
    'ale-rt',
    'alecghica',
    'alecpm',
    'aleGpereira',
    'amleczko',
    'andreasma',
    'anthonygerrard',
    'anuyens',
    'arterrey',
    'auspex',
    'avoinea',
    'avelino',
    'bakednotfried',
    'bdbaddog',
    'benniboy',
    'blambert555',
    'bloodbare',
    'bosim',
    'bsuttor',
    'bubenkoff',
    'buchi',
    'cah190',
    'calvinhp',
    'cbcunc',
    'ccrownhart',
    'cdw9',
    'cedricmessiant',
    'cekk',
    'cewing',
    'chaoflow',
    'chervol',
    'cillianderoiste',
    'claytonc',
    'claytron',
    'cleberjsantos',
    'cleder',
    'Clopy',
    'cpsaltis',
    'craspeh',
    'csenger',
    'cstengel',
    'Cuidightheach',
    'd-mo',
    'danilofreitas',
    'danjacka',
    'datakurre',
    'davidblewett',
    'davidemoro',
    'davidjb',
    'davilima6',
    'davisagli',
    'ddbeck',
    'ddellaquila',
    'DebVortex',
    'demarant',
    'djay',
    'djowett',
    'do3cc',
    'dokai',
    'dTordable',
    'duffyd',
    'dukebody',
    'ebrehault',
    'eleddy',
    'elioschmutz',
    'encolpe',
    'emanlove',
    'enfold-josh',
    'enzus',
    'epeli',
    'ericof',
    'erral',
    'esartor',
    'espenmn',
    'esteele',
    'fabiosurrage',
    'faro76',
    'flecox',
    'frapell',
    'fredvd',
    'frisi',
    'fschulze',
    'fsprenger',
    'fulv',
    'garbas',
    'gaudenz',
    'gbastien',
    'gborelli',
    'giacomos',
    'gil-cano',
    'glenfant',
    'gogobd',
    'gotcha',
    'gvizdyk',
    'gweis',
    'gyst',
    'hammertoe',
    'hannosch',
    'hannoschulz',
    'helmantel',
    'hietpasd',
    'hoka',
    'href',
    'HRodriguez',
    'huubbouma',
    'hvelarde',
    'ianderso',
    'ianderso',
    'ichim-david',
    'iElectric',
    'itd',
    'ivanteoh',
    'izak',
    'j23d',
    'jaroel',
    'jcbrand',
    'jcerjak',
    'jean',
    'jensens',
    'jessesnyder',
    'jfroche',
    'jhb',
    'jianaijun',
    'joka',
    'jonascho',
    'jone',
    'jonstahl',
    'jpgimenez',
    'jriboux',
    'jstegle',
    'j-craig',
    'k-j-kleist',
    'kaerumy',
    'kagesenshi',
    'kcleong',
    'kenmanheimer',
    'keul',
    'khink',
    'kingel',
    'kiorky',
    'kroman0',
    'kuetrzi',
    'l34marr',
    'lentinj',
    'lepri',
    'limi',
    'loechel',
    'lrowe',
    'luca-bellenghi',
    'lukasgraf',
    'lukebrannon',
    'lzdych',
    'maartenkling',
    'macagua',
    'maethu',
    'maikroeder',
    'malthe',
    'mamico',
    'marciomazza',
    'markvl',
    'martior',
    'MatthewWilkes',
    'mattss',
    'mauritsvanrees',
    'metatoaster',
    'mgogoulos',
    'mgogoulos',
    'mhora',
    'mikerhodes',
    'miohtama',
    'mishunov',
    'mitchellrj',
    'mjpieters',
    'morphex',
    'mrsavage',
    'MrTango',
    'muellert',
    'mylemix',
    'naro',
    'natea',
    'newbery',
    'ngeissel',
    'ninfaj',
    'npropadovic',
    'nrb',
    'nrgaway',
    'nruiz',
    'nueces',
    'nutjob4life',
    'oggers',
    'optilude',
    'parruc',
    'patrickwestphal',
    'pbauer',
    'pellekrogholt',
    'petschki',
    'phabegger',
    'phgross',
    'phlax',
    'pigeonflight',
    'pilz',
    'pingviini',
    'pjstevns',
    'plamut',
    'polyester',
    'prmtl',
    'prospchr',
    'pumazi',
    'pysailor',
    'Quimera',
    'radekj',
    'rafaelbco',
    'rafahela',
    'ralphjacobs',
    'ramonski',
    'rbanffy',
    'rbeylerian',
    'reebalazs',
    'reedobrien',
    'regebro',
    'reinhardt',
    'rnd0101',
    'rnixx',
    'rochecompaan',
    'ronniestevens',
    'rpatterson',
    'rudaporto',
    'runyaga',
    'rvanlaar',
    'SafPlusPlus',
    'saibatizoku',
    'saily',
    'scw',
    'seanupton',
    'senner',
    'sgraber',
    'shagi',
    'shentonfreude',
    'sidnei',
    'siebo',
    'silviot',
    'simahawk',
    'simonedeponti',
    'sithmel',
    'sjoerdve',
    'smcmahon',
    'sneridagh',
    'Solgema',
    'spanktar',
    'spereverde',
    'squibobblepants',
    'staeff',
    'StevenLooman',
    'stonor',
    'sunew',
    'svx',
    'sylvainb',
    'taito',
    'Tamosauskas',
    'tbenita',
    'tcurvelo',
    'tdesvenain',
    'TH-code',
    'themask96',
    'thepjot',
    'thet',
    'tiazma',
    'tiberiuichim',
    'till44',
    'tisto',
    'tkimnguyen',
    'tmassman',
    'tmog',
    'tomgross',
    'tomster',
    'toutpt',
    'travacic',
    'Tschanzt',
    'tzicatl',
    'uncleerniebs',
    'unclelarry',
    'valentinaB',
    'vangheem',
    'vincent-psarga',
    'vincentfretin',
    'vincic',
    'vipod',
    'vsomogyi',
    'wichert',
    'witekdev',
    'witsch',
    'wosc',
    'WouterVH',
    'xiru',
    'yboussard',
    'ymazzer',
    'yurj',
    'zedr',
    'zombified',
    'zopyx',
    'zotya',
    'zupo',
    'zworkb',
}

def repo_objects(repos):
    return {i[0]:GitRepo(i[1]) for i in repos.items()}

def get_github_accounts(accounts, token):
    geocoder = ggeocoder.Geocoder()
    users = getUtility(IUserDatabase)
    i = 0.0
    for account in accounts:
        i+=1
        print "%2d%% complete" % ((i/len(accounts))*100.0)
        gh_api = urllib2.urlopen("https://api.github.com/users/%s?access_token=%s" % (account,token))
        user = json.loads(gh_api.read())
        try:
            location = geocoder.geocode(user['location'])[0].coordinates
        except:
            location = None
        users.add_user(User(user.get('name', user['account']), user.get('email', None), location))
